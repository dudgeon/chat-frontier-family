# Session Metadata

Chat session titles and summaries are generated by the `generate-chat-name` edge function.
The hook counts only assistant messages and triggers the function after every **third assistant reply**. It uses OpenAI's
`gpt-4o` model and falls back to `gpt-3.5-turbo` if necessary.

Metadata is written server-side using the service role key so that row level security does
not block updates. The function updates `chat_sessions.name` and `chat_sessions.session_summary`
directly and returns the values only for debugging.

As of May 2025 the summary field is truncated to 200 characters before saving.
The UI displays this recap for adult accounts only.

To keep API costs low the request payloads are short and generation runs at most once every
three assistant messages.

Realtime updates rely on the `last_updated` timestamp. The `update_session_metadata`
function updates this column so broadcast events fire and the UI refreshes automatically.
In development a 3â€‘second fallback timer fetches metadata if no realtime event arrives.

Sample log entry (level:"info"):
```json
{"level":"info","event":"metadata.generated","session_id":"abc123","title":"Shopping List","summary":"We brainstormed dinner ideas."}
```
